<app-user-nav></app-user-nav>

<div class="group-detail-container">
  <h2>{{ groupName }}</h2>
  <p class="desc">{{ groupDescription }}</p>

  <!-- Members -->
  <h3>ğŸ‘¥ Members</h3>
  <ul class="members-list">
    <li *ngFor="let m of members">
      {{ m.username }}
    </li>
  </ul>

  <!-- Expenses -->
  <h3>ğŸ’¸ Expenses</h3>
  <div class="expenses">
    <div class="expense-card" *ngFor="let e of expenses">
      <p><b>{{ e.paidByName }}</b> paid â‚¹{{ e.amount }}</p>
      <small>{{ e.description }}</small>
    </div>
  </div>

  <!-- Add Expense Form -->
  <h3>â• Add Your Expense</h3>
  <form (ngSubmit)="addExpense()" #expenseForm="ngForm" class="expense-form">
    <div class="form-group">
      <label>Description</label>
      <input
        type="text"
        [(ngModel)]="newExpense.description"
        name="description"
        required
      />
    </div>

    <div class="form-group">
      <label>Amount</label>
      <input
        type="number"
        [(ngModel)]="newExpense.amount"
        name="amount"
        required
      />
    </div>

    <button type="submit" class="btn">Add Expense</button>
  </form>

  <!-- Balances -->
  <h3>ğŸ“Š Balances</h3>
  <ul class="balances">
    <li *ngFor="let m of members">
      {{ m.username }}:
      <span
        [ngClass]="{
          positive: balances[m.id] > 0,
          negative: balances[m.id] < 0
        }"
      >
        {{ balances[m.id] > 0 ? '+' : '' }}â‚¹{{ balances[m.id] || 0 }}
      </span>
    </li>
  </ul>

  <!-- Settlements -->
  <h3>ğŸ¤ Pending Settlements</h3>
  <div class="settlements" *ngIf="settlements.length > 0; else noSettlements">
    <div *ngFor="let s of settlements" class="settlement-card">
      <p>
        {{ getUserName(s.fromUserId) }} â†’ {{ getUserName(s.toUserId) }} :
        â‚¹{{ s.amount }}
      </p>

      <!-- Only logged-in user can pay their own dues -->
      <button
        *ngIf="s.fromUserId === loggedInUserId"
        class="pay-btn"
        (click)="payNow(s)"
      >
        Pay Now
      </button>
    </div>
  </div>

  <!-- Completed Settlements -->
  <h3>âœ… Completed Settlements</h3>
  <div class="settlements" *ngIf="completedSettlements.length > 0">
    <div *ngFor="let s of completedSettlements" class="settlement-card">
      <p>
        <b>{{ getUserName(s.fromUserId) }} â†’ {{ getUserName(s.toUserId) }} : â‚¹{{ s.amount }}</b>
        <span class="completed">âœ” Completed</span>
      </p>
    </div>
  </div>

  <ng-template #noSettlements>
    <p>All settled! ğŸ‰</p>
  </ng-template>
</div>
